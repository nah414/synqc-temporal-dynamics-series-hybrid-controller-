services:
  oauth2-proxy:
    environment:
      OAUTH2_PROXY_PROVIDER: "github"
      OAUTH2_PROXY_EMAIL_DOMAINS: "*"
      OAUTH2_PROXY_HTTP_ADDRESS: "0.0.0.0:4180"
      OAUTH2_PROXY_REDIRECT_URL: ${OAUTH2_PROXY_REDIRECT_URL:-http://localhost:8080/oauth2/callback}
      OAUTH2_PROXY_CLIENT_ID: ${OIDC_CLIENT_ID:-synqc-ci-client}
      OAUTH2_PROXY_CLIENT_SECRET: ${OIDC_CLIENT_SECRET:-synqc-ci-secret}
      OAUTH2_PROXY_COOKIE_SECRET: ${OAUTH2_PROXY_COOKIE_SECRET:-MTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTI=}
      OAUTH2_PROXY_REVERSE_PROXY: "true"
      OAUTH2_PROXY_SET_XAUTHREQUEST: "true"
      OAUTH2_PROXY_UPSTREAMS: "file:///dev/null"
      OAUTH2_PROXY_SKIP_PROVIDER_BUTTON: "true"
    command:
      - "--provider=github"
      - "--http-address=0.0.0.0:4180"
      - "--upstream=file:///dev/null"
      - "--email-domain=*"
      - "--set-xauthrequest=true"
      - "--reverse-proxy=true"
